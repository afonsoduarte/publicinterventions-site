{"version":3,"sources":["../assets/js/plugins.js"],"names":["Number","prototype","pad","len","Array","join","this","slice","CanvasDrawer","id","dataSource","that","init","getNewContent","setInterval","createRequestObject","objAjax","browser","navigator","appName","ActiveXObject","XMLHttpRequest","http","open","onreadystatechange","updateNewContent","send","clearCanvas","canvas","document","getElementById","context","getContext","clearRect","width","height","readyState","ctx","allText","responseText","allTextLines","split","strokeStyle","fillStyle","i","x","length","y","date","Date","now","fillText","getHours","getMinutes","getSeconds","moveTo","lineTo","stroke","data","j","radius","snd","Audio","Math","floor","play","beginPath","arc","PI","closePath","fill","WorkshopCanvas","color","doc","pdf","setProperties","title","author","creator","pdfx","drawLine","fileName","pdfAsDataURI","output","$","parent","find","append"],"mappings":"AACAA,OAAAC,UAAAC,IAAA,SAAAC,GACA,OAAA,GAAAC,OAAAD,EAAA,GAAAE,KAAA,KAAAC,MAAAC,OAAAJ,IAGAK,aAAA,SAAAC,EAAAC,GAEA,GAAAC,GAAAL,IACAA,MAAAG,GAAAA,EACAH,KAAAI,WAAAA,EAEAJ,KAAAM,KAAA,WACAD,EAAAE,cAAAF,EAAAD,YACAI,YAAA,WAAAH,EAAAE,cAAAF,EAAAD,aAAA,MAGAJ,KAAAS,oBAAA,WACA,GAAAC,GACAC,EAAAC,UAAAC,OAOA,OALAH,GADA,+BAAAC,EACA,GAAAG,eAAA,qBAGA,GAAAC,iBAMAf,KAAAgB,KAAAX,EAAAI,sBAEAT,KAAAO,cAAA,SAAAH,GAIA,MAHAC,GAAAW,KAAAC,KAAA,OAAAZ,EAAAD,YACAC,EAAAW,KAAAE,mBAAAb,EAAAc,iBACAd,EAAAW,KAAAI,KAAA,OACA,GAGApB,KAAAqB,YAAA,WACA,GAAAC,GAAAC,SAAAC,eAAAnB,EAAAF,IACAsB,EAAAH,EAAAI,WAAA,KACAD,GAAAE,UAAA,EAAA,EAAAL,EAAAM,MAAAN,EAAAO,SAGA7B,KAAAmB,iBAAA,WACA,GAAA,GAAAd,EAAAW,KAAAc,WAAA,CAEA,GAAAR,GAAAC,SAAAC,eAAAnB,EAAAF,IACA4B,EAAAT,EAAAI,WAAA,MACAM,EAAA3B,EAAAW,KAAAiB,aACAC,EAAAF,EAAAG,MAAA,UAEAJ,GAAAK,YAAA,SACAL,EAAAM,UAAA,SAEAhC,EAAAgB,YAAAhB,EAAAF,GAEA,KAAA,GAAAmC,GAAA,EAAA,GAAAA,EAAAA,IACA,GAAAC,GAAAD,GAAAhB,EAAAM,MAAA,IAAA,GAAA,CAIA,KAAA,GAAAU,GAAA,EAAAA,EAAAJ,EAAAM,OAAA,EAAAF,IAAA,CAEA,GAAAG,IAAAP,EAAAM,OAAAF,EAAA,GAAAhB,EAAAO,OAAAK,EAAAM,OAEAE,EAAA,GAAAC,MAAAA,KAAAC,MAAA,IAAAV,EAAAM,OAAA,IAAAF,EAEAP,GAAAc,SAAAH,EAAAI,WAAAlD,IAAA,GAAA,IAAA8C,EAAAK,aAAAnD,IAAA,GAAA,IAAA8C,EAAAM,aAAApD,IAAA,GAAA,EAAA6C,EAAA,GAGAV,EAAAkB,OAAA,GAAAR,GACAV,EAAAmB,OAAA5B,EAAAM,MAAA,GAAAa,GACAV,EAAAoB,QAGA,KAAA,GADAC,GAAAlB,EAAAI,GAAAH,MAAA,KACAkB,EAAA,EAAA,GAAAA,EAAAA,IACA,GAAAD,EAAAC,GAAA,EAAA,CAEA,GAAAd,GAAAc,GAAA/B,EAAAM,MAAA,IAAA,GAAA,GACA0B,EAAAF,EAAAC,EAGA,IAAAf,GAAAJ,EAAAM,OAAA,EAAA,CACA,GAAAe,GAAA,GAAAC,OAAA,0BAAAC,KAAAC,MAAAN,EAAAC,IAAA,OACAE,GAAAI,OAGA5B,EAAA6B,YACA7B,EAAA8B,IAAAtB,EAAAE,EAAA,EAAAa,EAAA,EAAA,EAAA,EAAAG,KAAAK,IAAA,GACA/B,EAAAgC,YACAhC,EAAAiC,YAQAC,eAAA,SAAA9D,EAAAC,EAAA8D,GAEA,GAAA7D,GAAAL,IACAA,MAAAG,GAAAA,EACAH,KAAAI,WAAAA,EACAJ,KAAAkE,MAAAA,EAEAlE,KAAAM,KAAA,WACAD,EAAAE,cAAAF,EAAAD,aAGAJ,KAAAS,oBAAA,WACA,GAAAC,GACAC,EAAAC,UAAAC,OAOA,OALAH,GADA,+BAAAC,EACA,GAAAG,eAAA,qBAGA,GAAAC,iBAMAf,KAAAgB,KAAAX,EAAAI,sBAEAT,KAAAO,cAAA,SAAAH,GAIA,MAHAC,GAAAW,KAAAC,KAAA,OAAAZ,EAAAD,YACAC,EAAAW,KAAAE,mBAAAb,EAAAc,iBACAd,EAAAW,KAAAI,KAAA,OACA,GAGApB,KAAAqB,YAAA,WACA,GAAAC,GAAAC,SAAAC,eAAAnB,EAAAF,IACAsB,EAAAH,EAAAI,WAAA,KACAD,GAAAE,UAAA,EAAA,EAAAL,EAAAM,MAAAN,EAAAO,SAGA7B,KAAAmB,iBAAA,WAEA,GAAA,GAAAd,EAAAW,KAAAc,WAAA,CAGA,GAAAR,GAAAC,SAAAC,eAAAnB,EAAAF,IACA4B,EAAAT,EAAAI,WAAA,MACAM,EAAA3B,EAAAW,KAAAiB,aACAC,EAAAF,EAAAG,MAAA,UAEAJ,GAAAK,YAAA/B,EAAA6D,MACAnC,EAAAM,UAAAhC,EAAA6D,MAEA7D,EAAAgB,YAAAhB,EAAAF,GAGA,IAAAgE,GAAA,GAAAC,IAGAD,GAAAE,eACAC,MAAAjE,EAAAF,GACAoE,OAAA,gBACAC,QAAA,UAOA,KAAA,GAFAjC,GAAA,EAEAD,EAAA,EAAAA,EAAAJ,EAAAM,OAAA,EAAAF,IAAA,CAEA,GAAAc,GAAAlB,EAAAI,GAAAH,MAAA,IAEA,KAAAG,IACAC,GAAAa,EAAA,GAAA,IAEA,IAAAX,GAAAW,EAAA,GAAA,EAAA,EAGArB,GAAAkB,OAAAV,EAAA,GAAAE,GACAV,EAAAmB,OAAAX,EAAA,GAAAE,GACAV,EAAAoB,QAEA,IAAAsB,GAAAlC,EAAA,CAEA4B,GAAAO,SAAAD,EAAA,GAAAhC,EAAAgC,EAAA,GAAAhC,EAAA,EAAA,SAIA,GAAAkC,GAAAtE,EAAAF,GAAA,KAAA,GAAAwC,OAAAK,aAAA,OACA4B,EAAAT,EAAAU,OAAA,WAAAF,SAAAA,GAIAG,GAAA,IAAAzE,EAAAF,IAAA4E,SAAAC,KAAA,MAAAC,OAAA,gBAAAL,EAAA","file":"plugins.js","sourcesContent":["// Pad numbers\nNumber.prototype.pad = function (len) {\n    return (new Array(len+1).join(\"0\") + this).slice(-len);\n}\n\nCanvasDrawer = function(id, dataSource) {\n\n    var that = this;\n    this.id = id;\n    this.dataSource = dataSource;\n\n    this.init = function() {\n        that.getNewContent( that.dataSource );\n        setInterval(function(){ that.getNewContent( that.dataSource ); },3000);\n    };\n\n    this.createRequestObject = function() {\n        var objAjax;\n        var browser = navigator.appName;\n        if(browser == \"Microsoft Internet Explorer\"){\n            objAjax = new ActiveXObject(\"Microsoft.XMLHTTP\");\n        }\n        else {\n            objAjax = new XMLHttpRequest();\n        }\n        return objAjax;\n    };\n\n    // Canvas.js\n    this.http = that.createRequestObject();\n\n    this.getNewContent = function( dataSource ){\n        that.http.open('post', that.dataSource );\n        that.http.onreadystatechange = that.updateNewContent;\n        that.http.send(null);\n        return false;\n    };\n\n    this.clearCanvas = function(){\n        var canvas = document.getElementById(that.id);\n        var context = canvas.getContext(\"2d\");\n        context.clearRect(0, 0, canvas.width, canvas.height);\n    };\n\n    this.updateNewContent = function() {\n        if(that.http.readyState == 4){\n\n            var canvas=document.getElementById(that.id);\n            var ctx=canvas.getContext(\"2d\");\n            var allText = that.http.responseText;\n            var allTextLines = allText.split(/\\r\\n|\\n/);\n            \n            ctx.strokeStyle = \"333333\";\n            ctx.fillStyle=\"333333\";\n            \n            that.clearCanvas(that.id);\n\n            for (var i=1; i<51; i++) {\n                var x = i * (canvas.width - 10) /51 + 5;\n                //ctx.fillText( i, x, 10);\n            }\n\n            for (var i=0; i<allTextLines.length-1; i++) {\n\n                var y = (allTextLines.length-i-1) * canvas.height /allTextLines.length;\n\n                var date = new Date(Date.now() - (allTextLines.length * 5000) + (i * 5000));\n\n                ctx.fillText( date.getHours().pad(2)+':'+date.getMinutes().pad(2)+':'+date.getSeconds().pad(2)  , 0, y + 3);\n\n                // draw horizontal lines\n                ctx.moveTo(50,y);\n                ctx.lineTo( canvas.width - 10 ,y);\n                ctx.stroke();\n                    \n                var data = allTextLines[i].split(',');\n                for (var j=1; j<51; j++) {\n                    if (data[j] > 0) {\n                        //draw dots\n                        var x = j* (canvas.width - 60) /51 + 50;\n                        var radius = data[j];\n\n                        //Play Audio on first line\n                        if(i == allTextLines.length-2 ) {\n                            var snd = new Audio(\"/templates/audio/Impact\"+Math.floor(data[j])+\".wav\"); // buffers automatically when created\n                            snd.play();\n                        }\n\n                        ctx.beginPath();\n                        ctx.arc(x, y, 1 + radius/4, 0 , 2 * Math.PI,false);\n                        ctx.closePath();\n                        ctx.fill();\n                    }\n                }\n            }\n        }\n    };\n};\n\nWorkshopCanvas = function(id, dataSource, color) {\n\n    var that = this;\n    this.id = id;\n    this.dataSource = dataSource;\n    this.color = color;\n\n    this.init = function() {\n        that.getNewContent( that.dataSource );\n    };\n\n    this.createRequestObject = function() {\n        var objAjax;\n        var browser = navigator.appName;\n        if(browser == \"Microsoft Internet Explorer\"){\n            objAjax = new ActiveXObject(\"Microsoft.XMLHTTP\");\n        }\n        else {\n            objAjax = new XMLHttpRequest();\n        }\n        return objAjax;\n    };\n\n    // Canvas.js\n    this.http = that.createRequestObject();\n\n    this.getNewContent = function( dataSource ){\n        that.http.open('post', that.dataSource );\n        that.http.onreadystatechange = that.updateNewContent;\n        that.http.send(null);\n        return false;\n    };\n\n    this.clearCanvas = function(){\n        var canvas = document.getElementById(that.id);\n        var context = canvas.getContext(\"2d\");\n        context.clearRect(0, 0, canvas.width, canvas.height);\n    };\n\n    this.updateNewContent = function() {\n\n        if(that.http.readyState == 4){\n\n            // Generate Canvas\n            var canvas=document.getElementById(that.id);\n            var ctx=canvas.getContext(\"2d\");\n            var allText = that.http.responseText;\n            var allTextLines = allText.split(/\\r\\n|\\n/);\n            \n            ctx.strokeStyle = that.color;\n            ctx.fillStyle= that.color;\n            \n            that.clearCanvas(that.id);\n\n            // GENERATE PDF\n            var doc = new pdf();\n\n            /* set properties on the document */\n            doc.setProperties({\n            title: that.id,\n            author: 'Afonso Duarte',\n            creator: 'pdf.js'\n            });\n\n            // DRAW\n\n            var x = 0;\n\n            for (var i=0; i<allTextLines.length-1; i++) {\n                    \n                var data = allTextLines[i].split(',');\n\n                if(i !== 0) {\n                    x += data[0]/630;\n                }\n                var y = (data[2]/1) + 15;\n\n                // CANVAS\n                ctx.moveTo(x, 80 + y);\n                ctx.lineTo(x, 80 - y);\n                ctx.stroke();\n\n                var pdfx = x/2;\n                // PDF\n                doc.drawLine(pdfx, 40 + y, pdfx, 40 - y, 1.0, 'solid');\n            }\n\n\n            var fileName = that.id+\"-\"+new Date().getSeconds()+\".pdf\";\n            var pdfAsDataURI = doc.output('datauri', {\"fileName\":fileName});\n\n            // create a link\n            // this seems to always work, except clicking the link destroys my FF instantly \n            $('#'+that.id).parent().find('h1').append(' (<a href = \"'+pdfAsDataURI+'\">PDF</a>)');\n\n\n        }\n\n    };\n};"],"sourceRoot":"/source/"}